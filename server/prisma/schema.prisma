generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Color {
  BLURPLE
  BLUE
  GREEN
  YELLOW
  ORANGE
  RED
  PURPLE
  MAGENTA
  PINK
  LIME
  TURQUOISE
  CYAN
}

model User {
  id              Int             @id @default(autoincrement())
  publicId        String          @default(uuid()) @unique
  email           String          @unique
  name            String
  password        String

  themeColor      Color           @default(BLURPLE) // User selected theme color
  iconAltColor    Color           @default(BLURPLE) // Used when user icon is not available, fallback
  description     String?
  icon            String?

  friends         User[]          @relation("UserFriends")
  friendsOf       User[]          @relation("UserFriends")

  ownedGuilds     Guild[]
  joinedGuilds    UserOnGuild[]
  directChannels  UserOnDirectChannel[]

  directMessages  DirectMessage[]
  guildMessages   GuildMessage[]
}

// GUILD

model Guild {
  id            Int             @id @default(autoincrement())
  publicId      String          @default(uuid()) @unique
  name          String
  icon          String?
  banner        String?  
  ownerId       Int

  owner         User            @relation(fields: [ownerId], references: [id])
  members       UserOnGuild[]
  channels      GuildChannel[]
}

model UserOnGuild {
  userId        Int
  guildId       Int
  role          String?         // admin, member, etc. To be added...

  user          User            @relation(fields: [userId], references: [id])
  guild         Guild           @relation(fields: [guildId], references: [id])

  @@id([userId, guildId])
}

model GuildChannel {
  id            Int             @id @default(autoincrement())
  publicId      String          @default(uuid()) @unique
  name          String

  guildId       Int
  guild         Guild           @relation(fields: [guildId], references: [id])

  messages      GuildMessage[]
}

model GuildMessage {
  id            Int             @id @default(autoincrement())
  content       String
  createdAt     DateTime        @default(now())

  senderId      Int
  channelId     Int

  sender        User            @relation(fields: [senderId], references: [id])
  channel       GuildChannel    @relation(fields: [channelId], references: [id])
}

// END GUILD

// DIRECT

model DirectChannel {
  id        Int                   @id @default(autoincrement())
  publicId  String                @default(uuid()) @unique
  isGroup   Boolean               @default(false)
  users     UserOnDirectChannel[]
  messages  DirectMessage[]
}

model UserOnDirectChannel {
  userId          Int
  directChannelId Int
  isHidden        Boolean           @default(false)

  user        User                  @relation(fields: [userId], references: [id])
  channel     DirectChannel         @relation(fields: [directChannelId], references: [id])

  @@id([userId, directChannelId])
}

model DirectMessage {
  id                Int                 @id @default(autoincrement())
  content           String
  createdAt         DateTime            @default(now())
  senderId          Int
  directChannelId   Int

  sender            User                @relation(fields: [senderId], references: [id])
  directChannel     DirectChannel       @relation(fields: [directChannelId], references: [id])
}

// END DIRECT